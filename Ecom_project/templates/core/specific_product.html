{% extends "base.html" %}
{% load static %}

{% block content %}


<script src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
  crossorigin="anonymous"></script>

{% include "navbar.html" %}


<main class="main">
  <!-- Page Title -->
  <div class="page-title light-background">
    <div class="container d-lg-flex justify-content-between align-items-center">
      <h1 class="mb-2 mb-lg-0">Product Details</h1>
      <nav class="breadcrumbs">
        <ol>
          <li><a href="{% url 'Home' %}">Home</a></li>
          <li class="current">Product Details</li>
        </ol>
      </nav>
    </div>
  </div><!-- End Page Title -->
  
{% if messages %}
<div class="messages">
  {% for message in messages %}
    <div class="alert {{ message.tags }}">
      <span>{{ message }}</span>
      <button class="close-btn" onclick="this.parentElement.style.display='none';">&times;</button>
    </div>
  {% endfor %}
</div>
{% endif %}

  <section id="product-details" class="product-details section">
    <div class="container" data-aos="fade-up" data-aos-delay="100">
      <div class="row g-4">
        <!-- Product Gallery -->
        <div class="col-lg-7" data-aos="zoom-in" data-aos-delay="150">
          <div class="product-gallery">
            <div class="main-showcase">
              <div class="image-zoom-container">
                <img src="{{ product.image.url }}" alt="{{ product.name }}"
                  class="img-fluid main-product-image">
              </div>
            </div>
          </div>
        </div>

        <!-- Product Details -->
        <div class="col-lg-5" data-aos="fade-left" data-aos-delay="200">
          <div class="product-details">
            <div class="product-badge-container">
              <span class="badge-category">{{ product.category}}</span>
              <div class="rating-group">
                <div class="stars">
                  <i class="fa fa-star" aria-hidden="true"></i>
                  <i class="fa fa-star" aria-hidden="true"></i>
                  <i class="fa fa-star" aria-hidden="true"></i>
                  <i class="fa fa-star" aria-hidden="true"></i>
                  <i class="fa fa-star-half-o" aria-hidden="true"></i>

                  
                </div>
                <span class="review-text">(127 reviews)</span>
              </div>
            </div>

            <h1 class="product-name">{{ product.name }}</h1>

            <div class="pricing-section">
              <div class="price-display">
                {% if product.sale %}
                <span class="sale-price">{{ product.sale_price }}</span><strike>{{product.price}}</strike>
                {% else %}
                <span class="sale-price">{{ product.price }}</span>
                {% endif %}

              </div>
            </div>

            <div class="product-description">
              <p>{{ product.description }}</p>

              <div class="availability-status" style='margin-top:20px;'>
                <div class="stock-indicator">
                  <i class="bi bi-check-circle-fill"></i>
                  <span class="stock-text" style='font-size:16px'>Available</span>
                </div>
                <div class="quantity-left">Only 23 items remaining</div>
              </div>
            </div>

            <!-- Purchase Options -->
            <div class="purchase-section">
              <div class="quantity-control">
                <label for="quantity">Quantity:</label>
                <div style="border:solid 1px; border-radius: 5px;padding: 2px 2px; display: flex;gap: 10px;">
                <button class='minus-btn' onclick="minus()">&minus;</button>
                <input type="number" id="quantity" name="quantity" value="1" min="1" max="18" style="border:none;width:20px;margin-left:5px">
                <button class='plus-btn'onclick='plus()'>&plus;</button></div>
              </div>


              {% if user.is_authenticated %}
              <div class="action-buttons">
                <!-- Add product id as data attribute -->
                <button class="btn primary-action" id="add-cart" value="{{ product.id }}"
                  type="button">
                  <i class="bi bi-bag-plus"></i>
                  Add to Cart
                </button>
              </div>
              {% else %}
              <div class="action-buttons">
                <a href="{% url 'login' %}" class="btn primary-action">
                  <i class="bi bi-bag-plus"></i> Login to Add
                </a>
              </div>
              {% endif %}
            </div>
            {% comment %} benefits section {% endcomment %}
            <div class="benefits-list">
              <div class="benefit-item">
                <i class="bi bi-truck"></i>
                <span style='font-size:12px'>Free delivery on orders over $75</span>
              </div>
              <div class="benefit-item">
                <i class="bi bi-arrow-clockwise"></i>
                <span style='font-size:12px'>45-day hassle-free returns</span>
              </div>
              <div class="benefit-item">
                <i class="bi bi-shield-check"></i>
                <span style='font-size:12px'>3-year manufacturer warranty</span>
              </div>
              <div class="benefit-item">
                <i class="bi bi-headset"></i>
                <span style='font-size:12px'>24/7 customer support available</span>
              </div>
            </div>
            
          </div>
        </div>
      </div>
 
  </section>
</main>

<script src="{% static 'assets/js/main.js' %}"></script>

<script>
  // Check if button pressed
  $(document).on('click', '#add-cart', function(e){
      e.preventDefault();
      $.ajax({
          type: 'POST',
          url: "{% url 'cart_add' %}",
          data: {
      product_id: $('#add-cart').val(),
      product_qty: $('#quantity').val(),
      csrfmiddlewaretoken: '{{ csrf_token }}',
      action: 'post'
          },
  
          success: function(json){
              console.log(json)
              $("#cart_quantity").text(json.cart_length);

              document.getElementById("cart_quantity").textContent = json.qty
              location.reload(); 
          },
  
          error: function(xhr, errmsg, err){
  
          } 
      });
  })

//Quatity changing using buttons
//increamenting using plus
function plus(){
  const qty=document.querySelector('#quantity');
  if(qty.value < 18){
    qty.value=Number(qty.value)+1;
}}

//decrementing using minus
function minus(){
  const qty=document.querySelector('#quantity');
  if (qty.value > 1){
    qty.value-=1
}}



  </script>
<hr>
{% include "footer.html" %}

{% endblock %}
